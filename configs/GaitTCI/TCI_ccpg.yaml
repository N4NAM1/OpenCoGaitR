# æ•°æ®é…ç½®
data_cfg:
  dataset_name: CCPG
  # ğŸ”¥ è¿™é‡Œå¡«ä½ çš„çˆ¶çº§ç›®å½•ï¼Œä»£ç ä¼šè‡ªåŠ¨æ‹¼ /RGB/
  dataset_root: /root/autodl-tmp/CCPG_Processed
  
  # ç´¢å¼•æ–‡ä»¶
  train_json: datasets/CCPG_RGB_JSON/CCPG/ccpg_cir_final.json
  split_config: datasets/CCPG_RGB_JSON/CCPG/CCPG.json

  # æ¨¡å¼
  use_features: false
  # feature_root: "/root/autodl-tmp/CASIA-B-Processed/CLIP_feature_Unmasked"
  
  # é¢„å¤„ç† (ä½¿ç”¨æˆ‘ä»¬åœ¨ transform.py é‡Œå†™çš„ç±»)
  transform:
    - type: CLIPImageProcessor
      size: 224

# æ¨¡å‹é…ç½®
model_cfg:
  model: GaitTCI

  backbone: openai/clip-vit-base-patch32
  
  # Combiner å‚æ•°
  projection_dim: 512
  hidden_dim: 2048



# ä¼˜åŒ–å™¨
optimizer_cfg:
  solver: AdamW
  lr: 1.0e-4
  weight_decay: 0.01

# è°ƒåº¦å™¨
scheduler_cfg:
  scheduler: cosine
  warmup_steps: 500

# Loss é…ç½® 
loss_cfg:
  type: CrossEntropyLoss  # æŒ‡å®š Loss ç±»å‹
  log_prefix: clip_loss
  alpha: 2             # é€†å‘ Loss æƒé‡ (Inverse Loss Weight)ï¼ˆcosine_similarityï¼‰

# è®­ç»ƒå¼•æ“é…ç½®
trainer_cfg:
  save_name: GaitTCI_alpha0.5 #æ³¨æ„ä¿å­˜åç§°
  epochs: 60
  # ğŸ”¥ è®­ç»ƒæ—¶: å¼€å¯å¤šè¿›ç¨‹åŠ é€Ÿè¯»å–
  num_workers: 16
  enable_float16: true

  clip_grad_norm: 5.0

  log_iter: 10000
  save_iter: 10000
  total_iter: 40000
  with_test: false  # è®­ç»ƒä¸­é€”æ˜¯å¦æµ‹è¯•
  sampler:
    batch_size: 32          # è®­ç»ƒæ—¶çš„ Batch Size
    train_max_frames: 16     # è®­ç»ƒæ—¶çš„å¸§æ•°
    type: StandardSampler    # å ä½ç¬¦ï¼Œè¡¨ç¤ºä½¿ç”¨æ ‡å‡† Mini-Batch é‡‡æ ·
  # DDP å‚æ•°
  sync_BN: false
  fix_BN: false
  find_unused_parameters: false

  # æ£€æŸ¥ç‚¹åŠ è½½è®¾ç½®
  restore_ckpt_strict: false # è®­ç»ƒä¸­æ–­æ¢å¤æ—¶ä¹Ÿéœ€è¦ False(Falseï¼Œå› ä¸ºæˆ‘ä»¬æ²¡å­˜ CLIP å‚æ•°
  restore_hint: 0

# è¯„ä¼°é…ç½®
evaluator_cfg:
  sampler:
      batch_size: 4           # æµ‹è¯•æ—¶çš„ Batch Size
      test_max_frames: all     # è¯„ä¼°æ—¶çš„å¸§æ•° (å¦‚æœæœ‰)
      type: InferenceSampler   # å ä½ç¬¦

  # æµ‹è¯•æ—¶: è®¾ä¸º 0 æˆ– 2ï¼Œé˜²æ­¢å†…å­˜çˆ†ç‚¸ 
  num_workers: 2

  metric_cfg:
    # ğŸ”¥ æ–°å¢ï¼šè‡ªå®šä¹‰ R@k åˆ—è¡¨
    k_list: [1, 5, 10, 50] 
    
    # è§†è§’åˆ†ç»„ (ä¿æŒä¸å˜)
    view_groups:
      front: ["000"]
      front-side: ["018","036","054"]
      side: ["072","090","108"]
      back-side: ["126","144","162"]
      back: ["180"]

  save_name: GaitTCI_alpha0.5 # æ³¨æ„ä¿å­˜åç§°æ˜¯å¦ä¸€è‡´

  enable_float16: false       # æµ‹è¯•æ—¶å¯ä»¥å¼€å¯ FP16 åŠ é€Ÿ (CLIP æ¨ç†é€šå¸¸æ”¯æŒ)
  restore_ckpt_strict: false # å¿…é¡»æ˜¯ Falseï¼Œå› ä¸ºæˆ‘ä»¬æ²¡å­˜ CLIP å‚æ•°
  restore_hint: 40000        # æŒ‡å®šè¦æµ‹è¯•çš„æƒé‡ (Iter æ•°)
